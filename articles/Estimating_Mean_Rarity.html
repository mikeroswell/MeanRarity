<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating mean rarity • MeanRarity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating mean rarity">
<meta property="og:description" content="MeanRarity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MeanRarity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Estimating_Mean_Rarity.html">Estimating mean rarity</a>
    </li>
    <li>
      <a href="../articles/Gods_estimator.html">Gods estimator of mean rarity</a>
    </li>
    <li>
      <a href="../articles/Using_MeanRarity.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Estimating_Mean_Rarity_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating mean rarity</h1>
            
      
      
      <div class="hidden name"><code>Estimating_Mean_Rarity.Rmd</code></div>

    </div>

    
    
<p>The <code>MeanRarity</code> package contains functions to compute, estimate, and visualize Hill numbers, using the framework that Hill numbers simply compute the abundance-weighted [generalized] mean species rarity of a community (rarity is the reciprocal of relative abundance). Additionally, the package contains functions for generating and sampling abundance vectors and generating plots. This vignette is not a comprehensive guide to the package. However, it includes data and code to replicate the quantitative main-text figures presented in <span class="citation">Roswell, Dushoff, and Winfree (2021)</span>. Thus, the examples in the vignette are ordered according to the figures in the article.</p>
<p>The goal of [Hill] diversity metrics is to summarize the distribution of species’ [relative] abundances. The first figure in the “Conceptual guide” is a visualization of the observed bee abundances from the four communities in the example dataset <code>beeObs</code>, analyzed in the guide. The package also includes a summary of those data, <code>beeAbunds</code>. The function <code><a href="../reference/radplot.html">radplot()</a></code> takes those data and returns a rank-abundance distribution plot. We love the new R package <code>patchwork</code> for assembling plots, and call that package here.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># to make RAD plot for communities comparable, use one maxab and one maxrich for all plots</span>
<span class="va">maxab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">max</span><span class="op">)</span><span class="op">)</span> <span class="co"># the maximum observed species abundance in any community</span>

<span class="va">maxrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="co"># maximum observed richness</span>


<span class="va">myplots</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">makedatind</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="../reference/radplot.html">radplot</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span>,<span class="va">makedatind</span><span class="op">]</span>, maxab <span class="op">=</span> <span class="va">maxab</span>, maxrich <span class="op">=</span> <span class="va">maxrich</span>
            , shape <span class="op">=</span> <span class="fl">13</span> <span class="op">+</span> <span class="va">makedatind</span> <span class="co"># solid filled shapes</span>
            , size <span class="op">=</span> <span class="fl">1.5</span>
            , fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1b9e77"</span>, <span class="st">"#d95f02"</span>, <span class="st">"#7570b3"</span>, <span class="st">"#e7298a"</span><span class="op">)</span><span class="op">[</span><span class="va">makedatind</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
                   , axis.text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>


<span class="va">myplots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="co"># first community</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span><span class="co"># syling</span>
<span class="fu"><a href="../reference/white_y.html">white_y</a></span><span class="op">(</span><span class="va">myplots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="co"># second community </span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="co"># styling</span>
<span class="va">myplots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span>  <span class="co"># third community</span>
<span class="fu"><a href="../reference/white_y.html">white_y</a></span><span class="op">(</span><span class="va">myplots</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># fourth community</span></code></pre></div>
<p><img src="Estimating_Mean_Rarity_files/figure-html/RAD%20plot-1.png" width="480"></p>
<p>The next figure in the guide shows that the expected value for both observed and estimated asymptotic richness increase with sample size. The code to generate expected diversity estimates is computationally expensive and we recommend not to run the code in this vignette. It is documented in the package in the file <code>"data-raw/DATASET.R"</code>, and the result is an exported dataset <code>mean_ests</code>. This script uses the function <code>subsam()</code>, which samples without replacement, and the function <code><a href="../reference/obs_est.html">obs_est()</a></code>, which computes Hill diversity estimates, including asymptotic estimates <span class="citation">(Chao and Jost 2015)</span> using functions modified from the R package <code>SpadeR</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># this takes a long time to run so we're going to stash it but export the data it creates</span>

<span class="va">sz</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">:</span><span class="fl">745</span> <span class="co">#sample sizes from 1 to maximum observed total abundance at a site</span>
<span class="va">nrep</span><span class="op">&lt;-</span><span class="fl">200</span> <span class="co">#Large enough because estimating means</span>

<span class="co">#tictoc::tic() #time this</span>
<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="co">#nc is number of cores to use in parallel processing</span>
<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multiprocess.html">multiprocess</a></span>, workers <span class="op">=</span> <span class="va">nc</span><span class="op">)</span> <span class="co">#this sets up the cluster</span>


<span class="va">div_ests</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nrep</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">{</span>
 <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfr</a></span><span class="op">(</span><span class="va">sz</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">map</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sitio</span><span class="op">)</span><span class="op">{</span>
      <span class="va">f</span><span class="op">&lt;-</span><span class="va">beeAbunds</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">sitio</span><span class="op">)</span><span class="op">)</span>
      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">x</span><span class="op">)</span><span class="op">{</span>
        <span class="va">comm</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">subsam</span><span class="op">(</span>size <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/obs_est.html">obs_est</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span>
                     , site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co">#tictoc::toc() #507 seconds with quad-core i7 processor, not bad.</span>
<span class="va">mean_narm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">}</span>
<span class="va">mean_ests</span> <span class="op">&lt;-</span> <span class="va">div_ests</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">individuals</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarize_all</a></span><span class="op">(</span><span class="va">mean_narm</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">site_ab</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">site</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">site</span>, abun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span>,<span class="va">site</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">mean_ests</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">site_ab</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cutrows <span class="op">=</span> <span class="va">individuals</span> <span class="op">&gt;</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">abun</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">#truncate the dataset because literal bootstrapping gets funny and  the Chao1</span>
  <span class="co">#levels off near observed abundance, didn't want to discuss this in guide</span>
  <span class="co">#since it's obvious but not interesting and possibly very confusing.</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">cutrows</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">individuals</span>, <span class="va">obsrich</span>, color <span class="op">=</span> <span class="va">site</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">chaorich</span>, color <span class="op">=</span> <span class="va">site</span>, shape <span class="op">=</span> <span class="va">site</span><span class="op">)</span>
             , size<span class="op">=</span><span class="fl">0.8</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"\nIndividuals"</span>, y <span class="op">=</span> <span class="st">"Species richness\n"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>
        , axis.text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "site"</span>
<span class="co">#&gt; Warning: Removed 257 rows containing missing values (geom_point).</span>

<span class="co">#&gt; Warning: Removed 257 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="Estimating_Mean_Rarity_files/figure-html/Species%20Accumulation%20Curves-1.png" width="480"></p>
<p>Figure 3 in the guide shows an empirical Hill diversity profile. The <code>MeanRarity</code> package has a function to produce such profiles, <code><a href="../reference/divpro.html">divpro()</a></code>. This lightweight function does not produce asymptotic estimates. Because the guide focused on the mean rarity formulation for Hill diversities, parameterizing the scaling exponent with <span class="math inline">\(\ell\)</span>, the profile is plotted from <span class="math inline">\(\ell = -1\)</span> to <span class="math inline">\(\ell =1\)</span>, whereas other software packages such as <code>iNEXT</code> and <code>SpadeR</code> plot the profile from <span class="math inline">\(q = 1-\ell =0\)</span> to <span class="math inline">\(q = 1-\ell =2\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">site_pro</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>site <span class="op">=</span> <span class="va">x</span>, <span class="fu"><a href="../reference/divpro.html">divpro</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span>, <span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="co">#make profile for each community</span>

<span class="va">site_pro</span> <span class="op">%&gt;%</span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">ell</span>, <span class="va">d</span>, color <span class="op">=</span> <span class="va">site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">site_pro</span> <span class="op">%&gt;%</span> 
                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ell</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
               , <span class="fu">aes</span><span class="op">(</span><span class="va">ell</span>, <span class="va">d</span>, color <span class="op">=</span> <span class="va">site</span>, shape <span class="op">=</span> <span class="va">site</span><span class="op">)</span>
               , size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
          , axis.text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>
          , legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="co">#this is the unicode for the curly l</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Exponent \U2113"</span>, y <span class="op">=</span> <span class="st">"Diversity"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></code></pre></div>
<p><img src="Estimating_Mean_Rarity_files/figure-html/Diversity%20profile%20plot-1.png" width="480"></p>
<p>A central idea in the guide is that researcher decisions can drive the results of biodiversity comparisons: how much to sample, how to standardize data, which diversity metric to use, and how to express uncertainty. <em>Figure 4</em> illustrates how some of these choices could alter interpretation of the example dataset.</p>
<p>The code below does not highlight any of the novel tools in the <code>MeanRarity</code> package. However, it does use <code><a href="../reference/Chao_Hill_abu.html">Chao_Hill_abu()</a></code>, a copy of an internal function from the R package <code>SpadeR</code>. To produce fig 4 in the MS, we used the R package <code>iNEXT</code>, which is not imported by <code>MeanRarity</code>. It also uses our simplified version of the code for computing approximate CI from <code>iNEXT</code>, an internal function <code>MeanRarity:::Bootstrap.CI_Df()</code>. This computes the same intervals as <code>iNEXT</code>. Although elsewhere in the Oikos forum piece, we critique these intervals, we included them in this figure to demonstrate how the choice of tools would or would not drive results.</p>
<p>This code chunk will likely take almost a minute to run.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#tictoc::tic() #time this</span>

<span class="va">iN_form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">by_size</span> <span class="op">&lt;-</span> <span class="fu">iNEXT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/iNEXT/man/estimateD.html">estimateD</a></span><span class="op">(</span><span class="va">iN_form</span>
                                , base <span class="op">=</span> <span class="st">"size"</span><span class="op">)</span>

<span class="va">by_coverage</span> <span class="op">&lt;-</span> <span class="fu">iNEXT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/iNEXT/man/estimateD.html">estimateD</a></span><span class="op">(</span><span class="va">iN_form</span>
                                , base <span class="op">=</span> <span class="st">"coverage"</span><span class="op">)</span>

<span class="va">by_effort</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">iN_form</span>, <span class="va">sum</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">size</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">iNEXT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/iNEXT/man/estimateD.html">estimateD</a></span><span class="op">(</span><span class="va">iN_form</span>
                    , base <span class="op">=</span> <span class="st">"size"</span>
                    , level <span class="op">=</span> <span class="va">size</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"observed"</span><span class="op">)</span>

<span class="op">}</span><span class="op">)</span>
    
<span class="va">iseveral</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">by_size</span>
                             , coverage <span class="op">=</span> <span class="va">by_coverage</span>
                             , effort <span class="op">=</span> <span class="va">by_effort</span>
                             , .id <span class="op">=</span> <span class="st">"standard"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">order</span><span class="op">)</span>
                   
<span class="co">#tictoc::toc()  #43 sec this time!?!?!</span>

<span class="co">#tictoc::tic()</span>
<span class="va">asyseveral</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sitio</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span><span class="op">{</span>
    <span class="va">theboots</span> <span class="op">&lt;-</span> <span class="fu">MeanRarity</span><span class="fu">:::</span><span class="fu">Bootstrap.CI_df</span><span class="op">(</span><span class="fu">pull</span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span>, <span class="va">sitio</span><span class="op">]</span><span class="op">)</span>, <span class="va">l</span><span class="op">)</span>
    <span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Chao_Hill_abu.html">Chao_Hill_abu</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span>, <span class="va">sitio</span><span class="op">]</span><span class="op">)</span>, <span class="va">l</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">beeAbunds</span><span class="op">[</span>, <span class="va">sitio</span><span class="op">]</span><span class="op">)</span>
               , order <span class="op">=</span> <span class="va">l</span>
               , qD <span class="op">=</span> <span class="va">est</span>
               , qD.LCL <span class="op">=</span> <span class="va">est</span> <span class="op">-</span> <span class="va">theboots</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
               , qD.UCL <span class="op">=</span> <span class="va">est</span> <span class="op">+</span> <span class="va">theboots</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#tictoc::toc() # &lt;2 seconds.</span>

<span class="va">asyseveral</span><span class="op">$</span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"asymptotic"</span>
<span class="va">asyseveral</span><span class="op">$</span><span class="va">standard</span> <span class="op">&lt;-</span> <span class="st">"asymptotic"</span>
<span class="va">allseveral</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">iseveral</span>, <span class="va">asyseveral</span><span class="op">)</span>
<span class="co">#diversities, standardized by effort</span>

<span class="co">#get some parameters of data</span>
<span class="co">#individuals in sample with fewest</span>
<span class="va">minm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">by_effort</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> 

<span class="va">minc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">by_effort</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>SC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">SC</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">SC</span><span class="op">)</span><span class="op">)</span> <span class="co"># coverage of sample with lowest</span>


<span class="va">tog</span> <span class="op">&lt;-</span> <span class="va">allseveral</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">standard</span>, <span class="va">site</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>

<span class="va">inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"order"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, divind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"richness"</span>
                                                           , <span class="st">"Hill-Shannon"</span>
                                                           , <span class="st">"Hill-Simpson"</span><span class="op">)</span>
                                                 , levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"richness"</span>
                                                              , <span class="st">"Hill-Shannon"</span>
                                                              , <span class="st">"Hill-Simpson"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">togn</span> <span class="op">&lt;-</span> <span class="va">tog</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inds</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "order"</span>

<span class="va">togn</span> <span class="op">&lt;-</span> <span class="va">togn</span> <span class="op">%&gt;%</span>     
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>divind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">divind</span>
                         , levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"richness"</span>
                                      , <span class="st">"Hill-Shannon"</span>
                                      , <span class="st">"Hill-Simpson"</span><span class="op">)</span><span class="op">)</span>
          , site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">site</span>
                          , levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IAS_3"</span>
                                     , <span class="st">"Cold Soil_5"</span>
                                     , <span class="st">"Lord Stirling_4"</span>
                                     , <span class="st">"Fox Hill_5"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">togn</span> <span class="op">&lt;-</span> <span class="va">togn</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>methlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">standard</span>
                          , levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"effort"</span>
                                       , <span class="st">"size"</span>
                                       , <span class="st">"coverage"</span>
                                       , <span class="st">"asymptotic"</span><span class="op">)</span>
                           , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"effort (14 transects)"</span>
                                        , <span class="st">"size (255 individuals)"</span>
                                        , <span class="st">"coverage (95.7%)"</span>
                                        , <span class="st">"asymptotic"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ebsize</span><span class="op">&lt;-</span><span class="fl">0.6</span>
<span class="va">ebw</span><span class="op">&lt;-</span><span class="fl">0.4</span>
<span class="va">psize</span><span class="op">&lt;-</span><span class="fl">2.5</span>

<span class="co">############################</span>
<span class="co"># make figures, which get stuck together.</span>
<span class="va">leftPlot</span> <span class="op">&lt;-</span> <span class="va">togn</span> <span class="op">%&gt;%</span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">methlab</span> <span class="op">!=</span> <span class="st">"asymptotic"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">site</span>, <span class="va">qD</span>, color <span class="op">=</span> <span class="va">site</span>, shape <span class="op">=</span> <span class="va">site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">qD.LCL</span>, ymax <span class="op">=</span> <span class="va">qD.UCL</span><span class="op">)</span>
                  , size <span class="op">=</span> <span class="va">ebsize</span>, width <span class="op">=</span> <span class="va">ebw</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">psize</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">divind</span> <span class="op">~</span> <span class="va">methlab</span>, switch <span class="op">=</span> <span class="st">"y"</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>
          , axis.ticks.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span>
          , panel.border <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>
          , strip.background <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>
          , strip.text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
          , axis.title.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>
          , legend.position <span class="op">=</span> <span class="st">"none"</span>
          , strip.placement <span class="op">=</span> <span class="st">"outside"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span>
                       , expand <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expand_scale</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#7570b3"</span>
                                , <span class="st">"#1b9e77"</span>
                                , <span class="st">"#e7298a"</span>
                                , <span class="st">"#d95f02"</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; Warning: `expand_scale()` is deprecated; use `expansion()` instead.</span>
<span class="va">rightPlot</span> <span class="op">&lt;-</span> <span class="va">togn</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">methlab</span> <span class="op">==</span> <span class="st">"asymptotic"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">qD</span>, color <span class="op">=</span> <span class="va">site</span>, shape <span class="op">=</span> <span class="va">site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">qD.LCL</span>, ymax <span class="op">=</span> <span class="va">qD.UCL</span><span class="op">)</span>
                         , size <span class="op">=</span> <span class="va">ebsize</span>, width <span class="op">=</span> <span class="va">ebw</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">psize</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">divind</span><span class="op">~</span><span class="va">methlab</span>, switch <span class="op">=</span> <span class="st">"y"</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>
                 , axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>
                 , axis.ticks.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span>,
        panel.border <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
        strip.background <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        strip.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
        strip.text.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        legend.position <span class="op">=</span> <span class="st">"none"</span>,
        strip.placement <span class="op">=</span> <span class="st">"outside"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span>
                     , expand <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expand_scale</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#7570b3"</span>
                              , <span class="st">"#1b9e77"</span>
                              , <span class="st">"#e7298a"</span>
                              , <span class="st">"#d95f02"</span> <span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: `expand_scale()` is deprecated; use `expansion()` instead.</span>



<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">leftPlot</span> <span class="op">+</span> <span class="va">rightPlot</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Estimating_Mean_Rarity_files/figure-html/Figure%204:%20diversity%20estimates%20with%20CI-1.png" width="672"></p>
<p>A key idea is that the amount of sampling itself (and not simply standardization) itself affects relative biodiversity estimates. We demonstrated this in the MS with Figure 5. Although the <code>MeanRarity</code> package exports <code><a href="../reference/sample_finite.html">sample_finite()</a></code>, <code><a href="../reference/sample_finite.html">sample_finite()</a></code>, and <code><a href="../reference/subcom.html">subcom()</a></code>, all convenience functions for sampling community data, to produce Fig. 5 no tools from <code>MeanRarity</code> were used.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this takes a long time to run so we're going to stash it but export the data</span>
<span class="co"># in the package</span>

<span class="co"># the idea here is to sample from 14 30-minute sampling bouts from each site and </span>
<span class="co"># compare coverage. While we resample 30-minute transects, we compute the</span>
<span class="co"># estimated sample coverage and count individuals in each subsample. We use this</span>
<span class="co"># to compare standardization methods. </span>

<span class="va">maxeff</span> <span class="op">&lt;-</span> <span class="fl">14</span>
<span class="va">reps</span> <span class="op">&lt;-</span> <span class="fl">9999</span>
<span class="co">#tictoc::tic() #time this</span>
<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="co">#nc is number of cores to use in parallel processing</span>
<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multiprocess.html">multiprocess</a></span>, workers <span class="op">=</span> <span class="va">nc</span><span class="op">)</span> <span class="co">#this sets up the cluster</span>

<span class="va">show_ests</span> <span class="op">&lt;-</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfr</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">reps</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">maxeff</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
    <span class="va">sam</span> <span class="op">&lt;-</span> <span class="va">beeObs</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sr</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html">do</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">start</span> <span class="op">%in%</span>
                         <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">start</span><span class="op">)</span>
                                , size <span class="op">=</span> <span class="va">maxeff</span> <span class="op">-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>
                                , replace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="va">subcom</span> <span class="op">&lt;-</span> <span class="va">sam</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">bee</span>, <span class="va">sr</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>abund <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">sr</span>
                    , value <span class="op">=</span> <span class="va">abund</span>
                    , fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">basicdat</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">subcom</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, <span class="va">obs_est</span><span class="op">)</span>, <span class="va">rbind</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">basicdat</span>, site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">subcom</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, transects <span class="op">=</span> <span class="va">maxeff</span> <span class="op">-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co">#tictoc::toc() #Under 2 hours with only 4 cores</span>

<span class="va">effort_means</span> <span class="op">&lt;-</span> <span class="va">show_ests</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">transects</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarize_at</a></span><span class="op">(</span>.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"n"</span>
                              , <span class="st">"coverage"</span>
                              , <span class="st">"obsrich"</span>
                              , <span class="st">"chaorich"</span>
                              , <span class="st">"obsshan"</span>
                              , <span class="st">"chaoshan"</span>
                              , <span class="st">"obssimp"</span>
                              , <span class="st">"chaosimp"</span><span class="op">)</span>, .funs <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>


<span class="co">#gather to make a prettier plot, will need to get fancy now that there's asy also</span>
<span class="va">effort_rare</span> <span class="op">&lt;-</span> <span class="va">effort_means</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>
  <span class="st">"richness_observed"</span> <span class="op">=</span> <span class="va">obsrich</span>
  , <span class="st">"richness_asymptotic"</span> <span class="op">=</span> <span class="va">chaorich</span>
  , <span class="st">"Hill-Shannon_observed"</span> <span class="op">=</span> <span class="va">obsshan</span>
  , <span class="st">"Hill-Shannon_asymptotic"</span> <span class="op">=</span> <span class="va">chaoshan</span>
  , <span class="st">"Hill-Simpson_observed"</span> <span class="op">=</span> <span class="va">obssimp</span>
  , <span class="st">"Hill-Simpson_asymptotic"</span> <span class="op">=</span> <span class="va">chaosimp</span>
  , size <span class="op">=</span> <span class="va">n</span>
  , effort <span class="op">=</span> <span class="va">transects</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"ell"</span>
                , value <span class="op">=</span> <span class="st">"diversity"</span>
                , <span class="st">"richness_observed"</span>
                , <span class="st">"richness_asymptotic"</span>
                , <span class="st">"Hill-Shannon_observed"</span>
                , <span class="st">"Hill-Shannon_asymptotic"</span>
                , <span class="st">"Hill-Simpson_observed"</span>
                , <span class="st">"Hill-Simpson_asymptotic"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">method</span>
                , value <span class="op">=</span><span class="va">xax</span>
                , <span class="va">effort</span>
                , <span class="va">size</span>
                , <span class="va">coverage</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">ell</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"divind"</span>, <span class="st">"etype"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>

<span class="va">effort_rare</span><span class="op">$</span><span class="va">divind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">effort_rare</span><span class="op">$</span><span class="va">divind</span>
                          , levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"richness"</span>
                                       , <span class="st">"Hill-Shannon"</span>
                                       , <span class="st">"Hill-Simpson"</span><span class="op">)</span>
                          , labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"richness"</span>
                                     , <span class="st">"Hill-Shannon"</span>
                                     , <span class="st">"Hill-Simpson"</span><span class="op">)</span><span class="op">)</span>
<span class="va">effort_rare</span><span class="op">$</span><span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">effort_rare</span><span class="op">$</span><span class="va">method</span>
                          , levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"effort"</span>
                                     , <span class="st">"size"</span>
                                     , <span class="st">"coverage"</span><span class="op">)</span><span class="op">)</span>
<span class="va">effort_rare</span><span class="op">$</span><span class="va">etype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">effort_rare</span><span class="op">$</span><span class="va">etype</span>
                         , levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"observed"</span>
                                      , <span class="st">"asymptotic"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">effort_rare</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">etype</span> <span class="op">==</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">xax</span>
             , <span class="va">diversity</span>
             , color <span class="op">=</span> <span class="va">site</span>
             , shape <span class="op">=</span> <span class="va">site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html">scale_alpha</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span> legend.position <span class="op">=</span> <span class="st">"none"</span>
         , axis.text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>
         , axis.title.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
         , panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.3</span>, <span class="st">"lines"</span><span class="op">)</span>
         , strip.placement.y <span class="op">=</span> <span class="st">"outside"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"    transects                            individuals                             % coverage    "</span>
       , y <span class="op">=</span> <span class="st">"diversity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">divind</span> <span class="op">~</span> <span class="va">method</span>, scales <span class="op">=</span> <span class="st">"free"</span>, switch <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></code></pre></div>
<p><img src="Estimating_Mean_Rarity_files/figure-html/Fig%205%20rarefaction-1.png" width="672"></p>
<p>We examine whether the same sensitivities apply to asymptotic diversity estimates, which present an alternative to the data standardization approaches, in Appendix C. In fact, within the range of sampling completeness and unevennesses in our dataset, the asymptotic diversity estimators seem as unreliable as sample diversity in demonstrating relative differences in diversity between communities.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">effort_rare</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">xax</span>, <span class="va">diversity</span>, color <span class="op">=</span> <span class="va">site</span>, shape <span class="op">=</span> <span class="va">site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">etype</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html">scale_alpha</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span> legend.position <span class="op">=</span> <span class="st">"none"</span>
         , axis.text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>
         , axis.title.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>
         , panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"lines"</span><span class="op">)</span>
         , strip.placement.y <span class="op">=</span> <span class="st">"outside"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># shoudl fix the spacing between x-axis labels</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"    transects                                     individuals                                     % coverage    "</span>
       , y <span class="op">=</span> <span class="st">"diversity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">divind</span> <span class="op">~</span> <span class="va">method</span> <span class="op">+</span> <span class="va">etype</span>, scales <span class="op">=</span> <span class="st">"free"</span>, switch <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_alpha_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Scale for 'alpha' is already present. Adding another scale for 'alpha', which</span>
<span class="co">#&gt; will replace the existing scale.</span>
<span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></code></pre></div>
<p><img src="Estimating_Mean_Rarity_files/figure-html/Appendix%20C%20rarefaction%20with%20estimators%20-1.png" width="672"></p>
<p>In Box 5, we visualize the mean rarity by finding a physical balance point. We hope this helps clarify how rarity is scaled by different means, but always weighted by the abundance of individuals. The function <code><a href="../reference/rarity_plot.html">rarity_plot()</a></code> generates these figures. They can also be generated interactively in the shiny app . The key thing to notice is that while the scaling of rarity changes with the exponent <span class="math inline">\(\ell\)</span>, the weighting of each species stays the same. This is the simplest way to see how Hill diversities compute mean rarity from relative abundances, and we find the mean rarity framework simpler than imagining that the <em>scaling</em> parameter somehow adjusts species <em>weighting</em>.</p>
<p>The balance plots are fairly complex, and use several exported functions from the <code>MeanRarity</code> package. They rely, of course, on Hill diversity computations, with the function <code><a href="../reference/rarity.html">rarity()</a></code>, which in turn calls <code><a href="../reference/pfun.html">pfun()</a></code> and <code><a href="../reference/ipfun.html">ipfun()</a></code> to compute power transformations and their inverse. Additionally, the plots are built with ggplot, and the curious reader may wish to explore the code (and even suggest improvements!).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># plot some rarity "balance plots" for guide to measuring diversity (Roswell et al. 2021 http://onlinelibrary.wiley.com/doi/10.1111/oik.07202/abstract)</span>
<span class="va">ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">8</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>

<span class="va">rich_bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rarity_plot.html">rarity_plot</a></span><span class="op">(</span><span class="va">ab</span>, <span class="fl">1</span>, base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_brewer</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> 
<span class="co">#&gt;      rarity plot expects a square viewport (likely issues in the RStudio plotting device) and resizes points based on</span>
<span class="co">#&gt;      min(dev.size() and noco (for number of columns).</span>
<span class="co">#&gt;      Selecting lines = T will plot stacks of individuals as a line element,</span>
<span class="co">#&gt;      which tends to be more robust to window size.</span>
<span class="co">#&gt;      Setting lines = T may be the best way to deal with overplotting,</span>
<span class="co">#&gt;      which results from several species with similar but not identical rarities. </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] "diversity = 6"            "community size = 40"     </span>
<span class="co">#&gt; [3] "max observed rarity = 40" "min observed rarity = 2"</span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>

<span class="va">shan_bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/white_y.html">white_y</a></span><span class="op">(</span><span class="fu"><a href="../reference/rarity_plot.html">rarity_plot</a></span><span class="op">(</span><span class="va">ab</span>, <span class="fl">0</span>, base_size <span class="op">=</span> <span class="fl">12</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#do not return all the text this time</span>
  <span class="fu">scale_color_brewer</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span>
<span class="co">#&gt;      rarity plot expects a square viewport (likely issues in the RStudio plotting device) and resizes points based on</span>
<span class="co">#&gt;      min(dev.size() and noco (for number of columns).</span>
<span class="co">#&gt;      Selecting lines = T will plot stacks of individuals as a line element,</span>
<span class="co">#&gt;      which tends to be more robust to window size.</span>
<span class="co">#&gt;      Setting lines = T may be the best way to deal with overplotting,</span>
<span class="co">#&gt;      which results from several species with similar but not identical rarities. </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>

<span class="va">simp_bal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/white_y.html">white_y</a></span><span class="op">(</span><span class="fu"><a href="../reference/rarity_plot.html">rarity_plot</a></span><span class="op">(</span><span class="va">ab</span>, <span class="op">-</span><span class="fl">1</span>, base_size <span class="op">=</span> <span class="fl">12</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_brewer</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span>
<span class="co">#&gt;      rarity plot expects a square viewport (likely issues in the RStudio plotting device) and resizes points based on</span>
<span class="co">#&gt;      min(dev.size() and noco (for number of columns).</span>
<span class="co">#&gt;      Selecting lines = T will plot stacks of individuals as a line element,</span>
<span class="co">#&gt;      which tends to be more robust to window size.</span>
<span class="co">#&gt;      Setting lines = T may be the best way to deal with overplotting,</span>
<span class="co">#&gt;      which results from several species with similar but not identical rarities. </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>

<span class="co">#assemble triptych with patchwork</span>
<span class="va">rich_bal</span> <span class="op">+</span>
  <span class="va">shan_bal</span> <span class="op">+</span>
  <span class="va">simp_bal</span></code></pre></div>
<p><img src="Estimating_Mean_Rarity_files/figure-html/Balance%20plot-1.png" width="864"></p>
<p>In the appendices of the guide we explored confidence interval performance for diversity estimates via simulation. The code we used to do this requires substantial computational resources and we conducted much of it on a university high performance computing cluster. Thus, we did not include the code and data in this R package (it can be found at (GITHUB LINK), and do not recommend running on a home/office computer with the sample sizes we used. However, to explore CI performance, we designed a way to simulate species abundance distributions (SADs) directly based on their Hill diversity, demonstrated below with the function <code><a href="../reference/fit_SAD.html">fit_SAD()</a></code>. In the github repository, you may see how we took the simulated abundance distributions, took random samples (with replacement), and for the random samples we computed the estimated confidence intervals (CI) given by <span class="citation">Chao and Jost (2015)</span>. We assessed what proportion of empirical CI contained the target value: the expected sample diversity or the true (simulated) diversity of the SAD.</p>
<p>First we generate SADs with the function <code><a href="../reference/fit_SAD.html">fit_SAD()</a></code>. <code><a href="../reference/fit_SAD.html">fit_SAD()</a></code> uses a target Simpson diversity and distributional family to set the relative abundance for a fixed number of species, where species relative abundances are given by evenly-spaced quantiles of the continuous [gamma or log-normal] distribution. The function uses three parameters: richness, evenness, and the parametric distribution family. Richness can be any integer &gt;0. To parameterize evenness, we used , which is equal to 1 with a perfectly even species-abundance distribution, and 0 when Hill-Simpson diversity reaches its minimum, 1, for any richness value <span class="citation">(Chao, Ricotta, and Aldo 2019)</span>. Hill-Simpson diversity is a positive number between 1 and richness. We used the log-normal distribution because it fits observed sample species abundance distributions well <span class="citation">(Enquist et al. 2019; Baldridge et al. 2016; Matthews et al. 2019)</span>. We used the gamma distribution because it fits observed species abundance distributions as well <span class="citation">(Matthews and Whittaker 2014; Matthews et al. 2019)</span>, but makes different assumptions about rare species. Generating many SADs with different diversities and distributional assumptions provides scope to test proposed confidence intervals <span class="citation">(Béguinot 2018)</span>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># simulate SADs for analysis</span>
<span class="va">SADs_list</span><span class="op">&lt;-</span><span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lnorm"</span>, <span class="st">"gamma"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">distr</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rich</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">.15</span>,<span class="fl">.25</span>,<span class="fl">.5</span>,<span class="fl">.75</span>,<span class="fl">.85</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">simp_Prop</span><span class="op">)</span><span class="op">{</span> <span class="co">#simp_Prop is evenness</span>
      <span class="fu"><a href="../reference/fit_SAD.html">fit_SAD</a></span><span class="op">(</span>rich <span class="op">=</span> <span class="va">rich</span>, simpson <span class="op">=</span> <span class="va">simp_Prop</span><span class="op">*</span><span class="op">(</span><span class="va">rich</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, distr <span class="op">=</span> <span class="va">distr</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  7.18739193244666e-47 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.20738866916926e-15 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.7925645196612e-09 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.99403602229893e-53 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.36083992426459e-17 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.21155246166887e-10 . </span>
<span class="co">#&gt; Consider implied community size.</span></code></pre></div>
<p>The function <code><a href="../reference/fit_SAD.html">fit_SAD()</a></code> provides useful way to simulate species abundance distributions. Unlike many methods to simulate SADs that rely on finite communities, fit_SAD provides only <em>relative</em> abundances. This is particularly desirable for testing the statistical behavior of Hill diversities, as these also consider only relative abundances. Another feature of <code><a href="../reference/fit_SAD.html">fit_SAD()</a></code> is that the true diversity (richness and Hill-Simpson diversity), along with a parametric distributional assumption, are the inputs to the simulation, and not downstream effects of other, ancillary parameters.</p>
<p><code><a href="../reference/fit_SAD.html">fit_SAD()</a></code>, like other methods, does require a sort of discrete approximation to continuous distributions. However, rather than rounding, this is simply achieved by taking the probability density of the selected distribution at evenly-spaced intervals as proportional to the relative abundances of each species.</p>
<p>To generate finite data for our research, samples from the simulated SADs are taken directly, without first simulating a finite pool or “community,” in contrast to other commonly used methods to simulate SADs <span class="citation">(May et al. 2018)</span>. Here’s a quick visualization of the SADs we just generated (this is not a figure in the MS). Rather than showing all 24, we’ll look at a sample of 6: The most and least even ones, and one of the intermediate ones as well, for each of the two distributional families.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># function to remove subscripts; apparently this way of making a labeller is now</span>
<span class="co"># deprecated</span>
<span class="va">remsub</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">variable</span>, <span class="va">value</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"_"</span>,<span class="st">" "</span>,<span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>

<span class="co">#function to summarize frequencies</span>
<span class="va">asab</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">namevec</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">namevec</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>

<span class="co"># make rank abundance distributions</span>
<span class="va">myabs</span><span class="op">&lt;-</span><span class="fu">map_dfr</span><span class="op">(</span><span class="fu">flatten</span><span class="op">(</span><span class="fu">flatten</span><span class="op">(</span><span class="va">SADs_list</span><span class="op">)</span><span class="op">)</span> <span class="co">#, function(x) data.frame(names(x)))</span>
               , <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ab<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">rel_abundances</span><span class="op">)</span><span class="op">}</span>
               , .id<span class="op">=</span><span class="st">"SAD"</span><span class="op">)</span>


<span class="va">myabs</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  SAD<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span>
  , skew<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"uneven"</span>, <span class="st">"int"</span>,<span class="st">"int"</span>, <span class="st">"int"</span>,<span class="st">"int"</span>, <span class="st">"even"</span><span class="op">)</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"uneven"</span>, <span class="st">"int"</span>, <span class="st">"even"</span><span class="op">)</span><span class="op">)</span>
  , dist<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"lognormal"</span>, <span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"gamma"</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lognormal"</span>, <span class="st">"gamma"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>abD<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">dist</span>, <span class="va">skew</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SAD</span>, <span class="va">abD</span>, <span class="va">dist</span>, <span class="va">skew</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>abrank <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">min_rank</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">ab</span><span class="op">)</span><span class="op">)</span>
                , log_relative_abundance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">ab</span><span class="op">)</span>
                , relative_abundance <span class="op">=</span> <span class="va">ab</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">#for plotting, gather the two scales to use `facet_grid`</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">scl</span>, <span class="va">rel_abund</span>, <span class="va">relative_abundance</span>, <span class="va">log_relative_abundance</span> <span class="op">)</span><span class="op">%&gt;%</span>
  <span class="co"># grab the extreme SADs and one intermediate for each distributional</span>
  <span class="co"># assumption, just the 200 spp versions (they look the same though)</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SAD</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"7"</span>,<span class="st">"10"</span>,<span class="st">"12"</span>,<span class="st">"19"</span>,<span class="st">"22"</span>,<span class="st">"24"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># plot the RADs to show difference between gamma and lognormal, more extreme</span>
  <span class="co"># with skew</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">abrank</span>, <span class="va">rel_abund</span>, color<span class="op">=</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.3</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">.4</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="co"># theme(text=element_text(size=16))+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"abundance rank"</span>, y<span class="op">=</span><span class="st">""</span>, color<span class="op">=</span><span class="st">""</span>, shape<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">scl</span><span class="op">)</span><span class="op">~</span><span class="va">skew</span>, scales<span class="op">=</span><span class="st">"free"</span>, switch<span class="op">=</span><span class="st">"y"</span>, labeller<span class="op">=</span><span class="va">remsub</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "SAD"</span>
<span class="co">#&gt; Warning: The labeller API has been updated. Labellers taking `variable` and</span>
<span class="co">#&gt; `value` arguments are now deprecated. See labellers documentation.</span></code></pre></div>
<p><img src="Estimating_Mean_Rarity_files/figure-html/visualize%20SADs-1.png" width="672"></p>
<p>In the supplementary materials for <span class="citation">(Roswell, Dushoff, and Winfree 2021)</span>, we demonstrate that the CI for diversity estimates based on the approach articulated in <span class="citation">(Chao and Jost 2015)</span> tend to be anti-conservative. The code and data for this are not exported by this package; the scripts to generate all relevant data and figures are available at [github link].</p>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Baldridge2016">
<p>Baldridge, Elita, David J. Harris, Xiao Xiao, and Ethan P. White. 2016. “An extensive comparison of species-abundance distribution models.” <em>PeerJ</em> 4: e2823. <a href="https://doi.org/10.7717/peerj.2823">https://doi.org/10.7717/peerj.2823</a>.</p>
</div>
<div id="ref-Beguinot2018a">
<p>Béguinot, Jean. 2018. “How to Extrapolate Species Abundance Distributions with Minimum Bias When Dealing with Incomplete Species Inventories.” <em>Advances in Research</em> 13 (4): 1–24. <a href="https://doi.org/10.9734/air/2018/39002">https://doi.org/10.9734/air/2018/39002</a>.</p>
</div>
<div id="ref-Chao2015">
<p>Chao, Anne, and Lou Jost. 2015. “Estimating diversity and entropy profiles via discovery rates of new species.” <em>Methods in Ecology and Evolution</em> 6 (8): 873–82. <a href="https://doi.org/10.1111/2041-21">https://doi.org/10.1111/2041-21</a>.</p>
</div>
<div id="ref-Chao2019">
<p>Chao, Anne, Carlo Ricotta, and Piazzale Aldo. 2019. “Quantifying evenness and linking it to diversity, beta diversity, and similarity.” <em>Ecology</em>, no. 0: 1–15. <a href="https://doi.org/10.1002/ecy.2852">https://doi.org/10.1002/ecy.2852</a>.</p>
</div>
<div id="ref-Enquist2019">
<p>Enquist, Brian J., Xiao Feng, Brad Boyle, Brian Maitner, Erica A. Newman, Peter Møller Jørgensen, Patrick R. Roehrdanz, et al. 2019. “The commonness of rarity: Global and future distribution of rarity across land plants.” <em>Science Advances</em> 5 (11): 1–14. <a href="https://doi.org/10.1126/sciadv.aaz0414">https://doi.org/10.1126/sciadv.aaz0414</a>.</p>
</div>
<div id="ref-Matthews2019">
<p>Matthews, Thomas J., Jon P. Sadler, Yasuhiro Kubota, Christopher W. Woodall, and Thomas A. M. Pugh. 2019. “Systematic variation in North American tree species abundance distributions along macroecological climatic gradients.” <em>Global Ecology and Biogeography</em> 28 (5): 601–11. <a href="https://doi.org/10.1111/geb.12879">https://doi.org/10.1111/geb.12879</a>.</p>
</div>
<div id="ref-Matthews2014">
<p>Matthews, Thomas J, and Robert J Whittaker. 2014. “Fitting and comparing competing models of the species abundance distribution: assessment and prospect.” <em>Frontiers of Biogeography</em> 6 (2). <a href="https://doi.org/10.21425/f5fbg20607">https://doi.org/10.21425/f5fbg20607</a>.</p>
</div>
<div id="ref-May2018a">
<p>May, Felix, Katharina Gerstner, Daniel J. McGlinn, Xiao Xiao, and Jonathan M. Chase. 2018. “mobsim: An R package for the simulation and measurement of biodiversity across spatial scales.” <em>Methods in Ecology and Evolution</em> 9 (6): 1401–8. <a href="https://doi.org/10.1111/2041-210X.12986">https://doi.org/10.1111/2041-210X.12986</a>.</p>
</div>
<div id="ref-Roswell2020">
<p>Roswell, Michael, Jonathan Dushoff, and Rachael Winfree. 2021. “A conceptual guide to measuring species diversity.” <em>Oikos</em> 130 (3): 321–38. <a href="https://doi.org/10.1111/oik.07202">https://doi.org/10.1111/oik.07202</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Roswell, Jonathan Dushoff.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
