<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gods estimator of mean rarity • MeanRarity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Gods estimator of mean rarity">
<meta property="og:description" content="MeanRarity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-018C47WP3Y"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-018C47WP3Y');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MeanRarity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.0003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Estimating_Mean_Rarity.html">Estimating mean rarity</a>
    </li>
    <li>
      <a href="../articles/Gods_estimator.html">Gods estimator of mean rarity</a>
    </li>
    <li>
      <a href="../articles/Using_MeanRarity.html">Using MeanRarity</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Gods_estimator_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Gods estimator of mean rarity</h1>
            
      
      
      <div class="hidden name"><code>Gods_estimator.Rmd</code></div>

    </div>

    
    
<p>Hill diversities (also called “Hill numbers”) have become standard for measuring diversity in ecology (cite the Ellison 2010 special issue). While many interpretations of Hill numbers have been discussed, including their relationship to species richness, Shannon’s entropy, and Simpson’s concentration, The package <code>MeanRarity</code> is designed to illustrate an alternative interpretation of Hill numbers as means of species rarity (the reciprocal of relative abundance) in a community. In this interpretation, the control parameter <span class="math inline">\(\ell\)</span> moves the index from arithmetic to geometric to harmonic means. Thus, Hill diversities differ in the scale on which species rarity is considered, but always weights species the same way (by their abundance) regardless of the scale being used. This interpretation is distinct from the common idea that the Hill parameter controls how rare vs. common species are “weighted.”</p>
<p>In this vignette, we show that the mean rarity perspective suggests a novel approach to estimating true diversity from a sample, using the fact that the sample mean is an unbiased estimate of the population mean. Although how to estimate a species’ rarity from sample data remains unsolved, we test the promise of this idea using what we call God’s estimator: All-knowing, God can plug in the true population parameters for each species. Nevertheless, maybe for fun, God chooses to compute the sample mean, weighting species’ true rarities by their sampled frequency.</p>
<p>Let’s see how God’s estimator works!</p>
<p>First, we simulate some SADs with known diversity using the function <code><a href="../reference/fit_SAD.html">fit_SAD()</a></code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># simulate SADs for analysis</span>
<span class="va">SADs_list</span><span class="op">&lt;-</span><span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lnorm"</span>, <span class="st">"gamma"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">distr</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rich</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">map</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>,<span class="fl">.15</span>,<span class="fl">.25</span>,<span class="fl">.5</span>,<span class="fl">0.75</span>,<span class="fl">.85</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">simp_Prop</span><span class="op">)</span><span class="op">{</span> <span class="co">#simp_Prop is evenness</span>
      <span class="fu"><a href="../reference/fit_SAD.html">fit_SAD</a></span><span class="op">(</span>rich <span class="op">=</span> <span class="va">rich</span>, simpson <span class="op">=</span> <span class="va">simp_Prop</span><span class="op">*</span><span class="op">(</span><span class="va">rich</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, distr <span class="op">=</span> <span class="va">distr</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.73323975748102e-23 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.20738866916926e-15 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.7925645196612e-09 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.83050169167485e-26 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.36083992426459e-17 . </span>
<span class="co">#&gt; Consider implied community size.</span>
<span class="co">#&gt; Warning in fit_SAD(rich = rich, simpson = simp_Prop * (rich - 1) + 1, distr = distr): Rarest species has relative abundance  1.21155246166887e-10 . </span>
<span class="co">#&gt; Consider implied community size.</span></code></pre></div>
<p>Now, let’s test estimator performance.We’ll compare what we’ve called “God’s estimator” to the naïve estimator (the mean of the observed rarities) and to a non-parametric, asymptotic diversity estimator (CITE Chao and Jost 2015). To assess performance, let’s look at the root mean squared error, and also bias.</p>
<p>We won’t run the first part as it could take a while.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">nreps</span> <span class="op">&lt;-</span> <span class="fl">9999</span>

<span class="va">ss_to_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>

<span class="va">flatsads</span> <span class="op">&lt;-</span> <span class="fu">flatten</span><span class="op">(</span><span class="fu">flatten</span><span class="op">(</span><span class="va">SADs_list</span><span class="op">)</span><span class="op">)</span>

<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>
<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="st">"multiprocess"</span>, workers <span class="op">=</span> <span class="va">nc</span><span class="op">)</span>
<span class="co"># options &lt;- furrr::furrr_options(seed = TRUE)</span>
<span class="fu">tic</span><span class="op">(</span><span class="op">)</span>
<span class="va">compare_ests</span> <span class="op">&lt;-</span> <span class="fu">map_dfr</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="kw">function</span><span class="op">(</span><span class="va">SAD</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">map_dfr</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ell</span><span class="op">)</span><span class="op">{</span>
   <span class="va">truth</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">flatsads</span><span class="op">[[</span><span class="va">SAD</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="va">ell</span><span class="op">]</span><span class="op">)</span>
   <span class="va">truep</span> <span class="op">=</span> <span class="va">flatsads</span><span class="op">[[</span><span class="va">SAD</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>
   <span class="va">dinfo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">flatsads</span><span class="op">[[</span><span class="va">SAD</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">future_map_dfr</span><span class="op">(</span>.x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nreps</span>, .f<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">nrep</span><span class="op">)</span><span class="op">{</span>
      <span class="fu">map_dfr</span><span class="op">(</span><span class="va">ss_to_test</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ss</span><span class="op">)</span><span class="op">{</span>
        <span class="va">subsam</span> <span class="op">=</span> <span class="fu"><a href="../reference/sample_infinite.html">sample_infinite</a></span><span class="op">(</span><span class="va">truep</span>, <span class="va">ss</span><span class="op">)</span>
        <span class="va">chaoest</span> <span class="op">=</span> <span class="fu"><a href="../reference/Chao_Hill_abu.html">Chao_Hill_abu</a></span><span class="op">(</span><span class="va">subsam</span>, <span class="va">ell</span><span class="op">)</span>
        <span class="va">naive</span> <span class="op">=</span> <span class="fu"><a href="../reference/rarity.html">rarity</a></span><span class="op">(</span><span class="va">subsam</span>, <span class="va">ell</span><span class="op">)</span>
        <span class="va">gods</span> <span class="op">=</span> <span class="fu"><a href="../reference/GUE.html">GUE</a></span><span class="op">(</span><span class="va">subsam</span>, <span class="va">truep</span>, <span class="va">ell</span><span class="op">)</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">bind_cols</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">truth</span>, <span class="va">chaoest</span>, <span class="va">naive</span>, <span class="va">gods</span>, n<span class="op">=</span><span class="va">ss</span>, <span class="va">ell</span>, <span class="va">SAD</span><span class="op">)</span>, <span class="va">dinfo</span><span class="op">)</span><span class="op">)</span>
      <span class="op">}</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="co"># , .options= options</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="fu">toc</span><span class="op">(</span><span class="op">)</span> <span class="co"># 6 mins on 2.9 GHz i7 quad core processor</span>
<span class="co"># define a function for computing the root mean square</span>
<span class="va">nasum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">}</span>
<span class="va">rootms</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu">nasum</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>
<span class="va">namean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">}</span>

<span class="va">errs</span> <span class="op">&lt;-</span> <span class="va">compare_ests</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">ell</span>, <span class="va">distribution</span>, <span class="va">fitted.parameter</span>, <span class="va">n</span>, <span class="va">SAD</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">mutate</span><span class="op">(</span>godsError <span class="op">=</span> <span class="va">gods</span> <span class="op">-</span> <span class="va">truth</span>
         , naiveError <span class="op">=</span> <span class="va">naive</span> <span class="op">-</span> <span class="va">truth</span>
         , chaoError <span class="op">=</span> <span class="va">chaoest</span> <span class="op">-</span> <span class="va">truth</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">summarize_at</span><span class="op">(</span>.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"godsError"</span>, <span class="st">"naiveError"</span>, <span class="st">"chaoError"</span><span class="op">)</span>, .funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rootms</span>, <span class="va">namean</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">godsError_fn1</span><span class="op">:</span><span class="va">chaoError_fn2</span>,
    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimator"</span>, <span class="st">".value"</span><span class="op">)</span>,
    names_sep <span class="op">=</span> <span class="st">"_"</span>
      <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">rename</span><span class="op">(</span>rmse <span class="op">=</span> <span class="va">fn1</span>, bias <span class="op">=</span> <span class="va">fn2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data to make plot prettier</span>
<span class="va">inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"ell"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, divind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"richness"</span>
                                                           , <span class="st">"Hill-Shannon"</span>
                                                           , <span class="st">"Hill-Simpson"</span><span class="op">)</span>
                                                 , levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"richness"</span>
                                                              , <span class="st">"Hill-Shannon"</span>
                                                            , <span class="st">"Hill-Simpson"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#plot</span>
<span class="va">errs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">mutate</span><span class="op">(</span>estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"*Error"</span>, <span class="st">""</span>, <span class="va">estimator</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  
  <span class="fu">left_join</span><span class="op">(</span><span class="va">inds</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SAD</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"8"</span>,<span class="st">"10"</span>,<span class="st">"12"</span>,<span class="st">"19"</span>,<span class="st">"22"</span>, <span class="st">"24"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">n</span>, <span class="va">rmse</span>, color <span class="op">=</span> <span class="va">estimator</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">divind</span><span class="op">~</span><span class="va">SAD</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"individuals"</span>, y <span class="op">=</span> <span class="st">"root mean squared error"</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "ell"</span></code></pre></div>
<p><img src="Gods_estimator_files/figure-html/plot%20rmse-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">errs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">mutate</span><span class="op">(</span>estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"*Error"</span>, <span class="st">""</span>, <span class="va">estimator</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  
  <span class="fu">left_join</span><span class="op">(</span><span class="va">inds</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SAD</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"7"</span>,<span class="st">"10"</span>,<span class="st">"12"</span>,<span class="st">"19"</span>,<span class="st">"22"</span>,<span class="st">"24"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">n</span>, <span class="va">bias</span>, color <span class="op">=</span> <span class="va">estimator</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">divind</span><span class="op">~</span><span class="va">SAD</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"individuals"</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "ell"</span></code></pre></div>
<p><img src="Gods_estimator_files/figure-html/plot%20bias-1.png" width="672"></p>
<p>In our simulations, God’s estimator was usually both less biased (in fact, it is unbiased) and more accurate, across variation in SAD shape, sample sizes, and values of the Hill control parameter. This is expected: God’s estimator uses information not available to other methods (nor to mortal ecologists).</p>
<p>For SAD 19 we see very large RMSE for species richness. This is because God, but not the other estimators, can distinguish the merely rare from the exceedingly rare, and SAD 19 has wildly rare species (a quarter of species have relative abundance of &lt; 1/ 10 million). When these species are included randomly in a sample, the mean rarity of that sample is very high. Our simulation may be untroubling then, even for proponents of God’s estimator. When ecologists sample SADs with hundreds of millions or billions of individuals (e.g. Rhizospheres), they likely do not attempt to quantify richness, given that it cannot be estimated reliably (CITE Haegeman et al. 2013), and also obtain reads from many more than a few hundred individuals. For God’s estimator not to be unduly swayed by the extraordinarily rare species, however, sample sizes will have to be extremely large. In the presence of such extreme rarity, God’s estimator remains unbiased, but will likely tend towards greater error than estimators that do not account for rarity orders of magnitude higher than the observed rarity in a sample.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#we can check out whether upping sample sizes by a factor of 100 is </span>
<span class="co"># sufficient to bring God's estimator in line, but it's pretty time consuming to </span>
<span class="co"># do this sampling, and with the extreme rarities in SAD 19 we don't actually </span>
<span class="co"># see God's estimator behaving well with sample sizes ≤1e7, so we won't do this </span>
<span class="co"># with brute force.</span>
<span class="co"># nreps &lt;- 999</span>
<span class="co"># </span>
<span class="co"># ss_to_test &lt;- floor(10^seq(5,7, 0.25))</span>
<span class="co"># SAD&lt;-19</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># nc &lt;- parallel::detectCores() - 1</span>
<span class="co"># future::plan(strategy = "multiprocess", workers = nc)</span>
<span class="co"># # options &lt;- furrr::furrr_options(seed = TRUE)</span>
<span class="co"># tic()</span>
<span class="co"># God_with_microbes &lt;- map_dfr(-1:1, function(ell){</span>
<span class="co">#    truth = as.numeric(flatsads[[SAD]][[2]][2-ell])</span>
<span class="co">#    truep = flatsads[[SAD]][[3]]</span>
<span class="co">#    dinfo = data.frame(t(flatsads[[SAD]][[1]]))</span>
<span class="co">#   future_map_dfr(.x=1:nreps, .f=function(nrep){</span>
<span class="co">#       map_dfr(ss_to_test, function(ss){</span>
<span class="co">#         subsam = sample_infinite(truep, ss)</span>
<span class="co">#         chaoest = Chao_Hill_abu(subsam, ell)</span>
<span class="co">#         naive = rarity(subsam, ell)</span>
<span class="co">#         gods = GUE(subsam, truep, ell)</span>
<span class="co">#         return(bind_cols(data.frame(truth, chaoest, naive, gods, n=ss, ell, SAD), dinfo))</span>
<span class="co">#       })</span>
<span class="co">#     }</span>
<span class="co">#     # , .options= options</span>
<span class="co">#     )</span>
<span class="co">#  })</span>
<span class="co"># toc()</span>
<span class="co"># </span>
<span class="co"># microbe_errs &lt;- God_with_microbes %&gt;% </span>
<span class="co">#   group_by(ell, distribution, fitted.parameter, n, SAD) %&gt;% </span>
<span class="co">#   mutate(godsError = gods - truth</span>
<span class="co">#          , naiveError = naive - truth</span>
<span class="co">#          , chaoError = chaoest - truth) %&gt;% </span>
<span class="co">#   summarize_at(.vars = c("godsError", "naiveError", "chaoError"), .funs = c(rootms, namean)) %&gt;% </span>
<span class="co">#   pivot_longer(godsError_fn1:chaoError_fn2,</span>
<span class="co">#     names_to = c("estimator", ".value"),</span>
<span class="co">#     names_sep = "_"</span>
<span class="co">#       ) %&gt;% </span>
<span class="co">#   rename(rmse = fn1, bias = fn2)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># microbe_errs %&gt;% </span>
<span class="co">#   mutate(estimator = gsub("*Error", "", estimator)) %&gt;%  </span>
<span class="co">#   left_join(inds) %&gt;% </span>
<span class="co">#   ggplot(aes(n, rmse, color = estimator)) +</span>
<span class="co">#   geom_line(alpha = 0.7, size =1.5) +</span>
<span class="co">#   facet_grid(~divind, scales = "free") +</span>
<span class="co">#   geom_hline(yintercept = 0) +</span>
<span class="co">#   theme_classic() +</span>
<span class="co">#   theme(axis.text.x = element_text(angle = 90)) +</span>
<span class="co">#   labs(x = "individuals")</span>
<span class="co"># </span>
<span class="co"># microbe_errs %&gt;% </span>
<span class="co">#   mutate(estimator = gsub("*Error", "", estimator)) %&gt;%  </span>
<span class="co">#   left_join(inds) %&gt;% </span>
<span class="co">#   ggplot(aes(n, bias, color = estimator)) +</span>
<span class="co">#   geom_line(alpha = 0.7, size =1.5) +</span>
<span class="co">#   facet_grid(~divind, scales = "free") +</span>
<span class="co">#   geom_hline(yintercept = 0) +</span>
<span class="co">#   theme_classic() +</span>
<span class="co">#   theme(axis.text.x = element_text(angle = 90)) +</span>
<span class="co">#   labs(x = "individuals")</span></code></pre></div>
<p>What are the implications of this for mortals? These simulations suggest that developing heuristics to estimate true species rarities might enable better diversity estimates, and pave a route to more principled confidence intervals for Hill numbers than is likely possible with the non-parametric estimators more commonly used today. While it is hard to imagine how an estimator for true rarity could accurately infer rarities far below n/1 (where n is sample size), our simulations (and logic) suggest that arithmetic mean rarity (i.e. richness), highly sensitive to the stochastic inclusion of these in samples, at bests presents a bias/variance trade-off between a mean rarity estimator (like God’s, but with estimated rather than true rarities) and more traditional asymptotic diversity estimators.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Roswell, Jonathan Dushoff.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
