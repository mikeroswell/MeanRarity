---
title: "Using_MeanRarity"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using_MeanRarity}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
```{r setup, include =F}
library(MeanRarity)
```
# Purpose

This R package allows estimating and visualizing Hill diversity (aka "Hill
numbers") in terms of the average species "rarity." Rarity is defined as the 
reciprocal of relative abundance.

The average species rarity may be simpler to interpret than a transformed,
generalized entropy (this is how Hill numbers are typically derived). The rarity
parameterization clarifies the role of the
scaling exponent, and this R package provides illustration tools to visualize
that scaling concretely. Furthermore, this framework may provide an entry point
for developing and testing diversity estimators and their related interval
estimates (e.g. confidence intervals); this package contains novel tools to
simulate species abundance distributions that should streamline that process.

# Computing Mean Rarity
`rarity()` computes Hill diversity of a sample, parameterized in terms of the
mean rarity. 

We define Hill diversity $D$ as the mean species rarity in the community

$$D=\left( \sum_{i=1}^{S}p_{i}(r_{i})^{\ell} \right)^{1/\ell} \tag{1}$$

where $D$ is diversity or mean rarity, $p_{i}$ is the relative abundance of species $i$, $r_{i}$ is the rarity of species $i$ (defined as the reciprocal of $p_{i}$), $S$ is the total species richness, and $\ell$ is the scaling exponent that determines the type of mean computed (Roswell et al. ND)

Hill diversity is more commonly written as 

$$D=\left( \sum_{i=1}^{S}p_{i}^{q} \right)^{1/1-q} \tag{2}$$ 

These expressions are equivalent when $\ell = 1-q$. Re-parameterizing Hill diversity in terms of species rarity can provide 
conceptual clarity. Equation 1 is a weighted mean rarity, where the weights (relative abundances, $p_i$) are factored out. Simplifying (as in Equation 2) hides the weighting by relative abundance, and leads to the claim that the scaling exponent is the "weight." The concrete meaning of "weight" when applied to $q$ in equation 2 may be difficult to understand. 

Because Equations 1 and 2 are algebraically equivalent, `rarity(x, l)` is equivalent to `vegan::renyi(x, scale = 1-l, hill = T)`.



```{r compute rarity}
```



# Interpreting Mean Rarity

`rarity_plot()` makes balance plots to visualize mean rarity.

"Balance plots" called with `rarity_plot()` illustrate the computation in 
`rarity()`. 

# Simulating communities with known diversity

`fit_SAD()` simulates a species abundance distribution with known richness,
Hill-Simpson diversity, and a distributional assumption (lognormal or gamma).


`fit_SAD()` is a potentially novel way to simulate abundance distributions that
always gives precisely the same relative abundances for a given set of
parameters, and may be a helpful tool for exploring the behavior of diversity
metrics under different sampling scenarios.


